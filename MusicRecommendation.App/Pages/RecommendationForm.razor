@page "/recommendations"
@using MusicRecommendation.App.Components
@using MusicRecommendation.App.Models
@inherits GridMusicBase
@inject NavigationManager UriHelper

<html>
<head>
    <style>
        button {
            border-radius: 12px;
            background-color: #FF6549;
            border: none;
            padding: 10px;
            color: white;
            margin-top: 10px;
        }

        #addmore {
            border-radius: 12px;
            background-color: #C2248B;
            border: none;
            padding: 10px;
            color: white;
            margin-top: 10px;
        }

        #submit {
            border-radius: 12px;
            background-color: #2ECC71;
            border: none;
            padding: 10px;
            color: white;
            margin-top: 10px;
        }

        #recommendationTable {
            margin-top: 40px;
        }

        #addtoplaylist {
            border-radius: 12px;
            background-color: #2ECC71;
            border: none;
            padding: 10px;
            color: white;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div>
        <div>
            <h4>Make Recommendations Based On These Songs:</h4>
            <RecommendationSongTable />
            <button @onclick="@onDeleteButtonClick">Delete List</button>
            <button id="addmore" @onclick="@onAddMoreButtonClick">Add More Songs</button>
            <button id="submit" @onclick="@onSubmitButtonClick">Submit</button>
        </div>
        <div id="recommendationTable">
            <h4>Here's your recommendations:</h4>
            @if (showRecommendationComponent)
            {
                <div><GridRecommendations mlList="_mlList"/></div>
            }

        </div>
    </div>
</body>
</html>
@code
    {

    bool showRecommendationComponent = false;
    List<Music> _mlList = new List<Music>();

    private string responses;

    async void onDeleteButtonClick()
    {
        await MusicService.DeleteSelectedSongs();

        UriHelper.NavigateTo("/account");
    }

    void onAddMoreButtonClick()
    {

        UriHelper.NavigateTo("/account");
    }


    async void onSubmitButtonClick()
    {



        RecommendationList = await MusicService.GetSelectedSongs();

        foreach(var song in RecommendationList)
        {
            responses = await MusicService.CreateRecommendationsRequest(song);
            string[] subs = responses.Split("%song%");
            Music myNewSong = new Music();
            myNewSong.Artist = subs[0];
            myNewSong.Track = subs[1];
            myNewSong.Playlist = "workout";
            myNewSong.Album = "null";

            _mlList.Add(myNewSong);

        }

        showRecommendationComponent = true;
        this.StateHasChanged();
    }

}
