@using MusicRecommendation.App.Models
@using Blazorise.DataGrid
@using System.IO
@using System.Text.Json
@using System.Text.Json.Serialization;
@inject IHttpClientFactory ClientFactory

<div>
    <DataGrid TItem="Music" Data=@songs>
        <DataGridColumn TItem="Music" Field="@nameof(Music.Artist)" Caption="Artist"></DataGridColumn>
        <DataGridColumn TItem="Music" Field="@nameof(Music.Song)" Caption="Song"></DataGridColumn>
        <DataGridColumn TItem="Music" Field="@nameof(Music.Album)" Caption="Album"></DataGridColumn>
        <DataGridColumn TItem="Music" Field="@nameof(Music.Playlist)" Caption="Playlist"></DataGridColumn>
    </DataGrid>
</div>


@code
{

    IEnumerable<Music> songs = Array.Empty<Music>();

    protected override async Task OnInitializedAsync()
    {


        var request = new HttpRequestMessage(HttpMethod.Get,
            "https://localhost:44355/api/Music");

        var client = ClientFactory.CreateClient();

        var response = await client.SendAsync(request);

        if (response.IsSuccessStatusCode)
        {
            using var responseStream = await response.Content.ReadAsStreamAsync();
            songs = await JsonSerializer.DeserializeAsync
                <IEnumerable<Music>>(responseStream);
        }
        else
        {
            Console.WriteLine("An error occured when fetching song data");
        }
    }




}




